<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>Plantilla Segura — Buenas Prácticas Web</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Content Security Policy: bloquea inline scripts/styles y orígenes no confiables -->
  <meta http-equiv="Content-Security-Policy"
        content="default-src 'self'; script-src 'self'; style-src 'self'; img-src 'self' data:; base-uri 'none'; form-action 'self'; frame-ancestors 'none'; upgrade-insecure-requests">
  <!-- Otras políticas útiles (poner también como headers en el servidor):
       Referrer-Policy: no enviar referrer completo a otros orígenes -->
  <meta name="referrer" content="strict-origin-when-cross-origin">
  <!-- Nota: Strict-Transport-Security, X-Content-Type-Options y X-Frame-Options
       deben configurarse como headers del servidor, no via <meta>. -->

  <style>
    :root { --bg:#0f172a; --card:#0b1220; --text:#e5e7eb; --muted:#9ca3af; --ok:#10b981; --warn:#f59e0b; --err:#ef4444; --border:#1f2937; }
    * { box-sizing: border-box }
    body { margin: 0; background: var(--bg); color: var(--text); font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
    .wrap { max-width: 960px; margin: 0 auto; padding: 24px; }
    .card { background: linear-gradient(180deg,#0b1220,#0a0f1a); border:1px solid var(--border); border-radius: 16px; padding: 20px; box-shadow: 0 10px 30px rgba(0,0,0,.3); margin: 12px 0; }
    h1, h2 { margin: 0 0 10px }
    label { display:block; margin-bottom: 6px }
    input, button { background:#0a0f1a; color:var(--text); border:1px solid var(--border); border-radius:10px; padding:10px 12px }
    input { width: 100% }
    button { cursor:pointer }
    .muted { color: var(--muted); font-size: 12px }
    .grid { display:grid; gap:12px; grid-template-columns: 1fr 1fr }
    ul { margin: 8px 0 0 18px }
    .ok { background:#073a2f; border-color:#065f46 }
    .warn { background:#3b2b07; border-color:#854d0e }
    .err { background:#3a0b0b; border-color:#7f1d1d }
    code { background:#111827; padding:2px 6px; border-radius:6px; border:1px solid #1f2937 }
    .badge { border:1px solid var(--border); border-radius:999px; padding:2px 8px; font-size:12px }
  </style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <h1>Plantilla de Ciberseguridad (Uso Ético)</h1>
    <p class="muted">
      Esta página demuestra **buenas prácticas defensivas** para aplicaciones web.
      Úsala sólo en tus propios sistemas o con autorización por escrito.
    </p>
    <span class="badge">CSP activo</span>
    <span class="badge">Sin inline JS/CSS</span>
    <span class="badge">Sin orígenes externos</span>
  </div>

  <div class="card">
    <h2>Formulario Seguro (con señales de CSRF & 2FA)</h2>
    <p class="muted">Ejemplo de UI: jamás muestra contraseñas; ilustra flags de seguridad.</p>
    <form id="secureForm" method="POST" action="/account/update" autocomplete="off">
      <div class="grid">
        <div>
          <label for="displayName">Nombre para mostrar</label>
          <input id="displayName" name="displayName" maxlength="40" placeholder="Tu nombre" required>
        </div>
        <div>
          <label for="email">Correo</label>
          <input id="email" name="email" type="email" inputmode="email" autocomplete="email" required>
        </div>
      </div>

      <!-- Campo de contraseña: no se muestra la actual; sólo cambio con confirmación -->
      <div class="grid" style="margin-top:12px">
        <div>
          <label for="newPw">Nueva contraseña (opcional)</label>
          <input id="newPw" name="newPw" type="password" minlength="12" autocomplete="new-password"
                 placeholder="Mínimo 12 caracteres">
        </div>
        <div>
          <label for="newPw2">Confirmar contraseña</label>
          <input id="newPw2" name="newPw2" type="password" minlength="12" autocomplete="new-password">
        </div>
      </div>

      <!-- Indicador de 2FA -->
      <div style="margin-top:12px">
        <label><input type="checkbox" id="require2fa"> Requerir 2FA para inicio de sesión</label>
      </div>

      <!-- Token CSRF: el backend debe emitirlo y validarlo -->
      <input type="hidden" id="csrf" name="csrf" value="<!-- inyecta token del servidor -->">

      <div style="margin-top:12px">
        <button type="submit" class="ok">Guardar cambios</button>
      </div>
      <p id="msg" class="muted" style="margin-top:8px"></p>
    </form>
  </div>

  <div class="card">
    <h2>Saneo de Entrada (cliente) — demostración</h2>
    <p class="muted">
      El saneo **servidor** es lo principal. Esto es un refuerzo visual en cliente:
      elimina etiquetas peligrosas y atributos de eventos antes de mostrar contenido.
    </p>
    <div class="grid">
      <div>
        <label for="userInput">Contenido del usuario (ej. bio, comentarios)</label>
        <input id="userInput" placeholder="Escribe texto; se filtrarán etiquetas no seguras">
        <button id="previewBtn" style="margin-top:8px">Previsualizar seguro</button>
      </div>
      <div>
        <label>Vista segura</label>
        <div id="preview" style="min-height:48px; padding:10px; border:1px dashed #1f2937; border-radius:10px"></div>
      </div>
    </div>
  </div>

  <div class="card">
    <h2>Checklist de Seguridad Web</h2>
    <ul>
      <li><strong>HTTPS + HSTS</strong> (header <code>Strict-Transport-Security</code> en el servidor).</li>
      <li><strong>CSP estricta</strong> (sin <code>'unsafe-inline'</code>, sin orígenes externos innecesarios).</li>
      <li><strong>Protecciones básicas</strong>: <code>X-Content-Type-Options: nosniff</code>, <code>X-Frame-Options: DENY</code> o <code>frame-ancestors</code> en CSP, <code>Referrer-Policy</code>.</li>
      <li><strong>Autenticación</strong>: passwords hasheadas con Argon2id/bcrypt (coste alto) + 2FA opcional/obligatorio según riesgo.</li>
      <li><strong>CSRF</strong>: tokens por sesión + validación de origen + SameSite cookies.</li>
      <li><strong>Validación</strong> en servidor (tipo, longitud, listas blancas) y sanitización de salida (escapar HTML).</li>
      <li><strong>Gestión de sesión</strong>: expiración corta, revocación en logout, rotación de tokens.</li>
      <li><strong>Registro/Auditoría</strong> de acciones sensibles, alertas de login, detección de anomalías.</li>
      <li><strong>Rate limiting</strong>, bloqueo incremental y CAPTCHA en endpoints de autenticación.</li>
      <li><strong>Backups cifrados</strong> y secretos en un gestor (no en repositorios).</li>
    </ul>
  </div>

  <div class="card">
    <h2>Marco Ético y Legal</h2>
    <p class="muted">
      Realiza pruebas sólo con <strong>autorización por escrito</strong>, define alcance, ventanas de tiempo y reglas de reporte.
      Usa canales de <em>responsible disclosure</em>. Nunca ataques sistemas ajenos.
    </p>
  </div>
</div>

<script>
/* Validaciones de formulario y saneo básico en cliente (además del servidor) */
(function(){
  const $ = s => document.querySelector(s);
  const msg = $('#msg');

  // Saneo: elimina tags y atributos riesgosos; ejemplo mínimo.
  function sanitize(input) {
    const tmp = document.createElement('div');
    tmp.textContent = input; // encode por defecto (escapa HTML)
    // Si quisieras permitir un subconjunto de etiquetas, implementar una whitelist aquí.
    return tmp.innerHTML;
  }

  $('#previewBtn').addEventListener('click', () => {
    const safe = sanitize($('#userInput').value);
    $('#preview').innerHTML = safe;
  });

  $('#secureForm').addEventListener('submit', (e) => {
    e.preventDefault();

    // Verifica contraseñas (si usuario decidió cambiarlas)
    const pw1 = $('#newPw').value;
    const pw2 = $('#newPw2').value;
    if (pw1 || pw2) {
      if (pw1.length < 12) { msg.textContent = 'La nueva contraseña debe tener al menos 12 caracteres.'; return; }
      if (pw1 !== pw2) { msg.textContent = 'Las contraseñas no coinciden.'; return; }
    }

    // Señal de 2FA
    const require2fa = $('#require2fa').checked;

    // Envío simulado: en producción usar fetch() a tu backend, con token CSRF válido
    msg.textContent = 'Datos validados en cliente. Enviar al servidor con validaciones y headers de seguridad.';
    console.log({
      displayName: $('#displayName').value.trim(),
      email: $('#email').value.trim(),
      newPw: pw1 ? '[NO ENVIAR EN LOGS]' : null,
      require2fa,
      csrf: $('#csrf').value
    });
  });
})();
</script>
</body>
</html>
